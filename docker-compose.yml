version: "3.9"

services:
  #  mongodb:
  #    image: mongo:4.4.5
  #    volumes:
  #      - ./data/db:/data/db
  #    environment:
  #      MONGO_INITDB_ROOT_USERNAME: ${MONGO_USER:-root}
  #      MONGO_INITDB_ROOT_PASSWORD: ${MONGO_PASS:-pass}
  #    ports:
  #      - "0.0.0.0:${MONGO_PORT:-27017}:27017"
  #    restart: always
  #
  #
  #  mongo-express:
  #    image: mongo-express:0.54.0
  #    restart: always
  #    environment:
  #      ME_CONFIG_MONGODB_ADMINUSERNAME: ${MONGO_USER:-root}
  #      ME_CONFIG_MONGODB_ADMINPASSWORD: ${MONGO_PASS:-pass}
  #      ME_CONFIG_MONGODB_AUTH_DATABASE: ${MONGO_DB:-threatmapper}
  #      ME_CONFIG_MONGODB_SERVER: ${MONGO_HOST:-mongodb}
  #      ME_CONFIG_MONGODB_PORT: ${MONGO_PORT:-27017}
  #    ports:
  #      - "0.0.0.0:${MONGO_EXPRESS_PORT:-8081}:8081"
  #    depends_on:
  #      - mongodb


  scanner:
    build: ./scraper
    command: poetry run python ./src/main.py
    environment:
      MONGO_USER: ${MONGO_USER:-root}
      MONGO_PASS: ${MONGO_PASS:-pass}
      MONGO_HOST: ${MONGO_HOST:-mongodb}
      MONGO_PORT: ${MONGO_PORT:-27017}
      MONGO_DB: ${MONGO_DB:-threatmapper}
      MONGO_COLL: ${MONGO_COLL:-attacks}
      SELENIUM: ${SELENIUM:-selenium}
    depends_on:
      #      - mongodb
      - selenium
    restart: always


  selenium:
    image: selenium/standalone-firefox:88.0
    ports:
      - 4444:4444
      - 7900:7900
    shm_size: '2gb'
    logging:
      driver: none


#  selenium-hub:
#    image: selenium/hub:4.0.0-beta-3-20210426
#    container_name: selenium-hub
#    ports:
#      - "4442:4442"
#      - "4443:4443"
#      - "4444:4444"
#
#
#  firefox:
#    image: selenium/node-firefox:4.0.0-beta-3-20210426
#    volumes:
#      - /dev/shm:/dev/shm
#    depends_on:
#      - selenium-hub
#    environment:
#      - SE_EVENT_BUS_HOST=selenium-hub
#      - SE_EVENT_BUS_PUBLISH_PORT=4442
#      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443
#    ports:
#      - "6902:5900"

